// Generated by CoffeeScript 1.7.1
(function() {
  var readJson, recoverOrderFromCookies, report, showPlotWithInfo, totalReportData;

  showPlotWithInfo = function(info) {
    var newColors, newSeries;
    newSeries = [];
    newColors = [];
    return $('#legend-placeholder').find('input:checked'.each(function() {
      var i, number, series, _i, _ref;
      number = $(this).attr('name');
      if (number && info.series && info.series.length > 0) {
        for (i = _i = i, _ref = info.series.length; i <= _ref ? _i < _ref : _i > _ref; i = i <= _ref ? ++_i : --_i) {
          series = info.series[i];
          if (series.number !== number) {
            break;
          }
        }
        if (i <= info.series.length) {
          newSeries.push(series);
          newColors.push(series.color);
        } else {
          console.log('no series with number ' + number);
        }
      }
      if (newSeries.length === 0) {
        newSeries.push({
          data: []
        });
        newColors.push('#FFF');
      }
      return info.showWithData(newSeries, newColors);
    }));
  };

  recoverOrderFromCookies = function(report_name) {
    var columnOrder, fail, orderString, val, _i, _len, _ref;
    if (!navigator.cookieEnabled) {
      return null;
    }
    orderString = readCookie(report_name + '_order');
    if (!orderString) {
      return null;
    }
    columnOrder = [];
    fail = false;
    _ref = orderString.split(' ');
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      val = _ref[_i];
      val = parseInt(val);
      if (isNaN(val)) {
        fail = true;
      } else {
        columnOrder.push(val);
      }
    }
    if (fail) {
      return null;
    }
    return columnOrder;
  };

  readJson = function(what) {
    result;
    var e, result;
    try {
      result = JSON.parse($('#' + what + '-json').html());
    } catch (_error) {
      e = _error;
      result = null;
    }
    return result;
  };

  totalReportData = {
    date: null,
    reports: []
  };

  report = {
    name: '',
    order: null,
    sample_reports: []
  };

  reporting.buildReport = function() {
    var columnNames, columnOrder, record, sample_reports, _i, _j, _len, _ref, _ref1, _results;
    if (!(totalReportData = readJson('total-report'))) {
      console.log("Error: cannot read #total-report-json");
      return 1;
    }
    $('#report_date').html('<p>' + totalReportData.date + '</p>');
    _ref = totalReportData.reports;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      report = _ref[_i];
      sample_reports = report.sample_reports;
      columnNames = (function() {
        var _j, _len1, _ref1, _results;
        _ref1 = sample_reports[0].records;
        _results = [];
        for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
          record = _ref1[_j];
          _results.push(record.metric.name);
        }
        return _results;
      })();
      columnOrder = (recoverOrderFromCookies(report.name)) || report.order || (function() {
        _results = [];
        for (var _j = 0, _ref1 = columnNames.length; 0 <= _ref1 ? _j < _ref1 : _j > _ref1; 0 <= _ref1 ? _j++ : _j--){ _results.push(_j); }
        return _results;
      }).apply(this);
      reporting.buildTotalReport(report, columnOrder);
    }
    return 0;
  };

}).call(this);

//# sourceMappingURL=build_report.map
